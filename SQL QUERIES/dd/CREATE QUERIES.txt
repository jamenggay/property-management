CREATE TABLE Properties (
    property_id INT AUTO_INCREMENT PRIMARY KEY,
    property_name VARCHAR(255) NOT NULL,
    type ENUM('Condominium', 'Studio Unit', 'Townhouse', 'Retail Space', 'Apartment') NOT NULL,
    house_number VARCHAR(50),
    street VARCHAR(255),
    municipality VARCHAR(100),
    province VARCHAR(100),
    country VARCHAR(100),
    availability ENUM('vacant', 'occupied') NOT NULL
);

CREATE TABLE Tenants (
    tenant_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    contact_number VARCHAR(20) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    property_id INT,
    FOREIGN KEY (property_id) REFERENCES Properties(property_id) ON DELETE SET NULL
);

CREATE TABLE Leases (
    lease_id INT AUTO_INCREMENT PRIMARY KEY,
    property_id INT NOT NULL,
    tenant_id INT NOT NULL,
    lease_start DATE NOT NULL,
    lease_end DATE NOT NULL,
    lease_status ENUM('active', 'expired', 'terminated') NOT NULL DEFAULT 'active',
    payment_frequency ENUM('monthly', 'quarterly', 'yearly') NOT NULL DEFAULT 'monthly',
    security_deposit DECIMAL(10,2) NOT NULL,
    rent_amount DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (property_id) REFERENCES Properties(property_id) ON DELETE CASCADE,
    FOREIGN KEY (tenant_id) REFERENCES Tenants(tenant_id) ON DELETE CASCADE
);

CREATE TABLE MaintenanceRequest (
    request_id INT AUTO_INCREMENT PRIMARY KEY,
    tenant_id INT NOT NULL,
    property_id INT NOT NULL,
    issue_type ENUM('Plumbing', 'Carpentry', 'HVAC', 'Electrical', 'Pest Control', 'Roofing', 'Cleaning', 'Flooring', 'Security', 'Appliance Repair', 'General Repairs') NOT NULL,
    description TEXT NOT NULL,
    priority ENUM('Urgent', 'Non-urgent') NOT NULL DEFAULT 'Non-urgent',
    status ENUM('Pending', 'In Progress', 'Completed') NOT NULL DEFAULT 'Pending',
    FOREIGN KEY (tenant_id) REFERENCES Tenants(tenant_id) ON DELETE CASCADE,
    FOREIGN KEY (property_id) REFERENCES Properties(property_id) ON DELETE CASCADE
);

CREATE TABLE Transactions (
    transaction_id INT AUTO_INCREMENT PRIMARY KEY,
    tenant_id INT NOT NULL,
    property_id INT NOT NULL,
    lease_id INT,
    m_request_id INT,
    transaction_type ENUM('rent payment', 'security deposit', 'maintenance request') NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    payment_method ENUM('Bank Transfer', 'G-cash', 'Cash', 'PayMaya') NOT NULL,
    transaction_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    payment_status ENUM('completed', 'pending', 'failed') NOT NULL DEFAULT 'pending',
    reference_number VARCHAR(50) UNIQUE NOT NULL,
    FOREIGN KEY (tenant_id) REFERENCES Tenants(tenant_id) ON DELETE CASCADE,
    FOREIGN KEY (property_id) REFERENCES Properties(property_id) ON DELETE CASCADE,
    FOREIGN KEY (lease_id) REFERENCES Leases(lease_id) ON DELETE SET NULL,
    FOREIGN KEY (m_request_id) REFERENCES MaintenanceRequest(request_id) ON DELETE SET NULL
);
